---
title: 파이썬 메타클래스 이해하기
tags:
  - python
---

파이썬은 OOP를 지원하는 언어이다. 따라서 일반적인 OOP 언어에서 지원하는 공통 기능들 역시 자유자재로 사용할 수 있다. 물론 언어별로 세부 구현 사항이나 문법구조는 다를 수 있겠지만. 기본적으로 클래스, 메서드, 상속과 같은 개념들이 있을 테고 다른 언어에서 `private` 키워드 등으로 설정할 수 있는 캡슐화를 위해 `def __method_name()`와 같이 언더스코어를 활용할 수도 있을 것이다. 더 나아가 자바 등이 지원하지 않는 다중 상속을 공부하다보면 [MRO(Method Resolution Order)](https://www.python.org/download/releases/2.3/mro/)를 이해하게 되고 [C3 Linearlization](https://en.wikipedia.org/wiki/C3_linearization)와 같은 알고리즘을 접하게 된다. 또 실제 프로젝트에서는 믹스인 패턴과 같은 여러 활용을 할 수 있게 된다.

보통 많은 사람들이 이 *공통 OOP 기능*을 중심으로 파이썬을 학습하시면 자신의 배움에 만족하게 된다. 물론 이 정도 수준이 되면 공통 OOP 기능 외에도 기본적인 FP나 동적 스크립트 언어의 장점을 십분 활용한 여러 편리한 기능들도 알게 된다. *XXX Comprehension*으로 불리는 편리한 기능들과 `*args`, `**kwargs` 같은 문법도 잘 활용할 수 있다. **Pythonic**하게 코딩하는 자기 자신을 보며 뿌듯함을 느낄 것이다. 내가 그랬으니까.

**메타클래스**라는 개념을 처음 접한 건 한 일 년 전 쯤이다. 주로 사용하는 Django 프레임워크는 메타클래스 기능을 기본적으로 사용하여 구현되어 있기 때문에 소스를 살펴보던 중 더욱 관심이 갔다. 그때는 한국어며 영어며 많은 자료들을 찾아 보았지만 온전히 이해했다는 느낌을 받지 못했다. 지금 다시 떠올려보면 이런 의문들이 남았었던 것 같다.

> "기본 메타클래스가 `type`이라는 클래스라는데, 이 클래스의 명세는 어디에 나와있길래 이런 기능들을 할 수 있는 거지?"

> "`MyClass = type('MyClass', (), {})`와 `type.__new__(type, 'MyClass', (), {})` 중 무엇을 써야 하지?"

> "위 물음에서 `__new__()`의 첫 인자로는 왜 `type`이 또 들어가지?"

> "모든 것은 객체라는데, 그렇다면 `type.__call__()`이 특별히 정의되어 있어서 클래스 정의를 수행해주는 건가?"

> "`__new__()`는 constructor, `__init__()`는 initializer인 건 알겠는데, 실제 활용에서 두 개를 구분할 수 있는 기준이 명확하게 있을까?" (`type`을 상속할 땐 `__new__()`를, 다른 클래스를 상속할 땐 `__init__()`을 구현하는 이유는 무엇일까?)

> "어떤 예제는 `__metaclass__`를 사용하고 어떤 예제는 `class MyClass(metaclass=MyMetaClass)`를 사용하는데, 두 개가 같은 건가?"

마지막을 제외한 나머지를 요약하자면 *"도대체 `type`의 정의가 뭔데?"* 정도일 것이다. 설명들을 보며 "아 메타클래스를 이런 문법을 통해 이용하면 이런 클래스를 생성할 수 있구나" 정도로 이해하는 것은 쉽다. 실제 사용된 코드를 봐도 방금 전 외운 문법에 따라 대입하면 얼추 뭘 하려는 건지 이해도 간다. 그러나 이건 추가적인 **문법**을 외운 것의 결과이고 메타클래스를 일반적인 클래스의 **예외**로 받아들였기 때문에 이해가 되는 것이라고 생각한다.

내 상식으로는 결국 `type`도 (소문자로 시작하지만) 클래스라면, 내가 아는 클래스의 행동양식을 따르거나 내가 아는 클래스의 행동양식을 확장한 더욱 일반적인 규칙에 의해 규율되어야 한다. 추가 문법, 추가 예외사항을 더하는 것이 아닌, 더 포괄적인 문법과 규칙을 알아내고 싶었다. 그럼 굳이 메타클래스를 알지 않아도 메타클래스를 이해하게 될 테니까.

참고로 마지막 의문에 대한 답을 하자면, 전자는 파이썬 2, 후자는 파이썬3에서 사용하는 방식이다. [(PEP-3115)](https://www.python.org/dev/peps/pep-3115/)

## 모든 것은 객체다.

파이썬에서 모든 것은 객체이다. 숫자, 문자열, 배열, 클래스 인스턴스 뿐만 아니라 **클래스도, 함수도, 메서드도 모두 객체**이다. 이 사실은 굉장히 중요하다. 모든 대상을 *객체*의 논리로 다룰 수 있다는 뜻이고, 이는 모든 대상이 최소한의 공통특성을 공유한다는 얘기이기도 한다. 클래스와 함수와 숫자 모두 넓게 보면 같은 종류인 것이다.

객체가 있다면 이 객체의 청사진도 있을 터. 일종의 템플릿으로 생각하면 된다. 이 템플릿을 **타입**이라고 부른다. 같은 타입을 갖는 객체는 같은 규칙에 의해 동작한다. 헷갈림을 더하는 말일 테지만, 특정 **타입 역시 객체**이다.
